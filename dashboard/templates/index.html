<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SISMONICAMARAS Dashboard</title>
  <link rel="stylesheet" href="/static/style.css">
  <script>
    async function updateStatus() {
      const res = await fetch("/status");
      const data = await res.json();
      document.getElementById("inside").innerText = data.inside;
      document.getElementById("entered").innerText = data.entered;
      document.getElementById("exited").innerText = data.exited;
    }

    async function sendEvent(action) {
      await fetch(`/event/${action}`, { method: "POST" });
      updateStatus();
    }

    async function toggleCamera() {
      const res = await fetch("/toggle_camera", {method: "POST"});
      const data = await res.json();
      if (data.camera_active) {
          document.getElementById("videoFeed").src = "/video";
      } else {
          document.getElementById("videoFeed").src = "";
      }
    }

    async function updateDurations() {
      const res = await fetch("/durations");
      const data = await res.json();
      let html = "";
      for (const [id, seconds] of Object.entries(data)) {
        html += `<p>Persona ${id}: ${Math.round(seconds)} segundos</p>`;
      }
      document.getElementById("durations").innerHTML = html;
    }

    setInterval(updateStatus, 2000);
    setInterval(updateDurations, 5000);
    window.onload = function() {
      updateStatus();
      updateDurations();
    }
  </script>
</head>
<body>
  <!-- Encabezado con logo de la empresa -->
  <header>
    <h1 style="color: blue;">HI - TECH PEOPLE SAS</h1>
    <h2>Sistema de Monitoreo de C√°maras</h2>
  </header>

  <!-- Controles de la c√°mara -->
  <section class="camera-control" style="text-align:center; margin:20px;">
    <h3>üì∑ C√°mara en Tiempo Real</h3>
    <button onclick="toggleCamera()" style="padding:10px 20px; background:blue; color:white; border-radius:10px;">
      Encender/Apagar C√°mara
    </button>
    <div style="margin-top:15px;">
      <img id="videoFeed" src="" width="640" height="480" alt="Video en vivo"/>
    </div>
  </section>

  <!-- Estado -->
  <section class="status">
    <h3>üìä Estado Actual</h3>
    <p><strong>Personas dentro:</strong> <span id="inside">0</span></p>
    <p><strong>Total Entradas:</strong> <span id="entered">0</span></p>
    <p><strong>Total Salidas:</strong> <span id="exited">0</span></p>
  </section>

  <!-- Tiempos de permanencia -->
  <section class="durations">
    <h3>‚è±Ô∏è Tiempos de Permanencia</h3>
    <div id="durations"></div>
  </section>

  <!-- Controles manuales -->
  <section class="controls">
    <button onclick="sendEvent('entered')">‚ûï Entrada</button>
    <button onclick="sendEvent('exited')">‚ûñ Salida</button>
  </section>

  <!-- Reportes -->
  <section class="reports">
    <h3>üìë Reportes</h3>
    <button onclick="window.location.href='/reports/daily'">Reporte Diario</button>
    <button onclick="window.location.href='/reports/weekly'">Reporte Semanal</button>
    <button onclick="window.location.href='/reports/monthly'">Reporte Mensual</button>
  </section>
</body>
</html>